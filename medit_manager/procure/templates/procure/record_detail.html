{% extends "procure/base.html" %}
{% load humanize %}
{% load custom_filters %}

{% block title %}Chi tiáº¿t há»“ sÆ¡{% endblock %}

{% block content %}
<body class="container mt-5">

  <h2 class="mb-4 text-primary">{{ record.code }} - {{ record.title }}</h2>
  <p class="mb-3"><strong>MÃ´ táº£:</strong> {{ record.description|default:"(KhÃ´ng cÃ³ mÃ´ táº£)" }}</p>

  <p>
    Tráº¡ng thÃ¡i thanh toÃ¡n:
    {% if record.is_paid %}
      <span class="badge bg-success fs-6">ÄÃ£ thanh toÃ¡n</span>
    {% else %}
      <span class="badge bg-warning text-dark fs-6">ChÆ°a thanh toÃ¡n</span>
    {% endif %}
  </p>

  <!-- Danh sÃ¡ch file Ä‘Ã­nh kÃ¨m -->
  <h4 class="mt-4">ğŸ“ File Ä‘Ã­nh kÃ¨m</h4>
  <ul>
    {% for f in record.attachments.all %}
      <li>
        <a href="{{ f.file.url }}" target="_blank">
          {{ f.file.name|cut:"procure/attachments/" }}
        </a>
        {% if f.description %} - <small class="text-muted">{{ f.description }}</small>{% endif %}
      </li>
    {% empty %}
      <li class="text-muted">KhÃ´ng cÃ³ file Ä‘Ã­nh kÃ¨m.</li>
    {% endfor %}
  </ul>

  <!-- Danh sÃ¡ch mÃ³n Ä‘Ã£ mua -->
  <h4 class="mt-5">ğŸ›’ Danh sÃ¡ch máº·t hÃ ng Ä‘Ã£ mua</h4>
  <table class="table table-bordered table-hover">
    <thead class="table-light text-center align-middle">
      <tr>
        <th>STT</th>
        <th>TÃªn mÃ³n</th>
        <th>ÄÆ¡n vá»‹</th>
        <th>Sá»‘ lÆ°á»£ng</th>
        <th>ÄÆ¡n giÃ¡</th>
        <th>ThÃ nh tiá»n</th>
      </tr>
    </thead>
    <tbody>
      {% for item in record.items.all %}
        <tr class="text-center align-middle">
          <td>{{ forloop.counter }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.unit|default:"-" }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.unit_price|intdot }} Ä‘</td>
          <td>{{ item.total_price|intdot }} Ä‘</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7" class="text-center text-muted">ChÆ°a cÃ³ máº·t hÃ ng nÃ o.</td>
        </tr>
      {% endfor %}
    </tbody>
    {% if record.items.all %}
    <tfoot>
      <tr>
        <th colspan="5" class="text-end">Tá»•ng trá»‹ giÃ¡:</th>
        <th colspan="2" class="text-primary text-center align-middle">
            {{ total_cost|intdot }} Ä‘
        </th>
      </tr>
    </tfoot>
    {% endif %}
  </table>

  <a href="{% url 'procure:record_list' %}" class="btn btn-secondary">â† Quay láº¡i danh sÃ¡ch</a>

</body>
{% endblock content %}
